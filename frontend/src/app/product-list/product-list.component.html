<!-- Hero Section -->
<div class="bg-dark text-secondary px-4 py-5 text-center mb-5 hero-banner">
  <div class="py-5">
    <h1 class="display-5 fw-bold text-white">Find Your Next Favorite Thing</h1>
    <div class="col-lg-6 mx-auto">
      <p class="fs-5 mb-4 text-light">Premium products, exceptional quality, and curated collections just for you.</p>
      <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
        <button type="button" class="btn btn-primary btn-lg px-4 me-sm-3 fw-bold" (click)="shopNow()">Shop Now</button>
        <button type="button" class="btn btn-outline-info btn-lg px-4" (click)="showNewest()">New
          Arrivals</button>
      </div>
    </div>
  </div>
</div>

<div class="container mb-5">
  <!-- Sort and Filter Section -->
  <div class="row mb-4">
    <div class="col-lg-3 col-md-4 mb-3">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="fw-bold mb-3">
            <i class="bi bi-sliders me-2"></i>Filters
          </h6>

          <!-- Price Range Filter -->
          <div class="mb-3">
            <label class="form-label small fw-semibold">Price Range</label>
            <div class="d-flex justify-content-between mb-2">
              <span class="small text-muted">₹{{minPrice}}</span>
              <span class="small text-muted">₹{{maxPrice}}</span>
            </div>
            <input type="range" class="form-range" [(ngModel)]="minPrice" [min]="priceRange.min" [max]="priceRange.max"
              (change)="onPriceRangeChange()" />
            <input type="range" class="form-range" [(ngModel)]="maxPrice" [min]="priceRange.min" [max]="priceRange.max"
              (change)="onPriceRangeChange()" />
          </div>

          <!-- Stock Filter -->
          <div class="mb-3">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="inStockFilter" [(ngModel)]="inStockOnly"
                (change)="onStockFilterChange()">
              <label class="form-check-label small" for="inStockFilter">
                In Stock Only
              </label>
            </div>
          </div>

          <!-- Reset Filters Button -->
          <button class="btn btn-outline-secondary btn-sm w-100" (click)="resetFilters()">
            <i class="bi bi-arrow-clockwise me-1"></i>Reset Filters
          </button>
        </div>
      </div>
    </div>

    <div class="col-lg-9 col-md-8">
      <!-- Header with Sort -->
      <div class="row align-items-center mb-3" id="products-section">
        <div class="col-md-6">
          <h2 class="fw-bold m-0"><span *ngIf="selectedCategory">{{ selectedCategory }}</span> Products</h2>
          <p class="text-muted" *ngIf="!loading && products.length > 0">{{ products.length }} items found</p>
        </div>
        <div class="col-md-6">
          <div class="d-flex justify-content-md-end align-items-center">
            <label class="me-2 small fw-semibold">Sort by:</label>
            <select class="form-select form-select-sm" style="max-width: 200px;" [(ngModel)]="sortBy"
              (change)="onSortChange()">
              <option value="">Default</option>
              <option value="price-asc">Price: Low to High</option>
              <option value="price-desc">Price: High to Low</option>
              <option value="name-asc">Name: A-Z</option>
              <option value="name-desc">Name: Z-A</option>
              <option value="newest">Newest First</option>
              <option value="popular">Popularity</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Category Filter Buttons -->
      <div class="mb-3">
        <div class="btn-group flex-wrap" role="group">
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="applyFilters(); selectedCategory=''">All</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Electronics'; applyFilters()">Electronics</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Fashion'; applyFilters()">Fashion</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Home & Kitchen'; applyFilters()">Home</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Fitness'; applyFilters()">Fitness</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Beauty'; applyFilters()">Beauty</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Books'; applyFilters()">Books</button>
          <button type="button" class="btn btn-outline-secondary btn-sm"
            (click)="selectedCategory='Leisure'; applyFilters()">Leisure</button>
        </div>
      </div>

      <!-- Active Filters Display -->
      <div class="mb-3" *ngIf="getActiveFilters().length > 0">
        <div class="d-flex align-items-center flex-wrap gap-2">
          <span class="small fw-semibold text-muted">Active Filters:</span>
          <span *ngFor="let filter of getActiveFilters()"
            class="badge bg-secondary d-inline-flex align-items-center gap-2">
            {{ filter.label }}
            <i class="bi bi-x-circle" style="cursor: pointer;" (click)="removeFilter(filter.type)"></i>
          </span>
          <button class="btn btn-link btn-sm text-decoration-none p-0" (click)="resetFilters()">
            Clear All
          </button>
        </div>
      </div>

      <div *ngIf="loading" class="text-center my-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2 text-muted">Curating the best products for you...</p>
      </div>

      <div *ngIf="errorMessage" class="alert alert-danger shadow-sm rounded-3" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ errorMessage }}
      </div>

      <div *ngIf="!loading && !errorMessage">
        <div *ngIf="products.length === 0" class="text-center py-5">
          <div class="card shadow-sm p-5 border-0 rounded-4">
            <div class="mb-3">
              <i class="bi bi-search display-1 text-muted"></i>
            </div>
            <h4>No products found</h4>
            <p class="text-muted">We couldn't find any products matching your selection. Try adjusting your search or
              filters.</p>
            <div class="mt-3">
              <button class="btn btn-primary px-4" (click)="selectedCategory=''; searchQuery=''; resetFilters()">Show
                All Products</button>
            </div>
          </div>
        </div>

        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" *ngIf="products.length > 0">
          <div class="col" *ngFor="let product of products">
            <div class="card h-100 shadow-sm border-0 product-card">
              <div class="position-relative overflow-hidden" [routerLink]="['/products', product.id]"
                style="cursor: pointer;">
                <img [src]="product.mainImageUrl || 'assets/placeholder.jpg'" class="card-img-top product-img"
                  [alt]="product.name" onerror="this.src='https://placehold.co/600x400?text=Product+Image'">
                <span class="position-absolute top-0 start-0 m-2 badge rounded-pill bg-primary">{{ product.category
                  }}</span>
                <!-- Stock Badge -->
                <span class="position-absolute top-0 end-0 m-2 badge" [ngClass]="{
                        'bg-success': product.stockQuantity >= 20,
                        'bg-warning text-dark': product.stockQuantity > 0 && product.stockQuantity < 20,
                        'bg-danger': product.stockQuantity === 0
                      }">
                  <i class="bi bi-box-seam me-1"></i>
                  {{ product.stockQuantity > 0 ? (product.stockQuantity >= 20 ? 'In Stock' : 'Low Stock') : 'Out of
                  Stock' }}
                </span>
              </div>
              <div class="card-body d-flex flex-column">
                <h5 class="card-title fw-bold text-truncate" [routerLink]="['/products', product.id]"
                  style="cursor: pointer;">{{ product.name }}</h5>
                <div class="rating-stars small mb-2 text-warning d-flex align-items-center gap-1">
                  <div class="stars">
                    <i class="bi" [ngClass]="product.rating >= 1 ? 'bi-star-fill' : 'bi-star'"></i>
                    <i class="bi" [ngClass]="product.rating >= 2 ? 'bi-star-fill' : 'bi-star'"></i>
                    <i class="bi" [ngClass]="product.rating >= 3 ? 'bi-star-fill' : 'bi-star'"></i>
                    <i class="bi" [ngClass]="product.rating >= 4 ? 'bi-star-fill' : 'bi-star'"></i>
                    <i class="bi" [ngClass]="product.rating >= 5 ? 'bi-star-fill' : 'bi-star'"></i>
                  </div>
                  <span class="text-dark fw-bold">{{ product.rating | number:'1.1-1' }}</span>
                </div>
                <p class="card-text text-muted small flex-grow-1 text-truncate-2">{{ product.description }}</p>
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <span class="fs-4 fw-bold text-dark">{{ product.price | currency:'INR':'symbol' }}</span>
                  <button class="btn btn-dark btn-sm rounded-pill px-3" (click)="addToCart(product)">
                    <i class="bi bi-cart-plus me-1"></i> Add
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>